"use strict";function initialize(){charts.light=new google.visualization.Gauge(document.getElementById("light")),chartOpts.light={min:0,max:1e3,yellowFrom:600,yellowTo:800,redFrom:800,redTo:1e3,minorTicks:20,width:200,height:200},charts.sound=new google.visualization.ColumnChart(document.getElementById("sound")),chartOpts.sound={min:0,max:70,width:250,height:250,legend:{position:"none"}},charts.temperature=new google.visualization.ColumnChart(document.getElementById("temperature")),chartOpts.temperature={min:0,max:40,width:250,height:250,legend:{position:"none"}},charts.humidity=new google.visualization.ColumnChart(document.getElementById("humidity")),chartOpts.humidity={min:0,max:100,width:250,height:250,legend:{position:"none"}},charts.gasPressure=new google.visualization.ColumnChart(document.getElementById("gasPressure")),chartOpts.gasPressure={min:80,max:130,width:250,height:250,legend:{position:"none"}},charts.motion=new google.visualization.ColumnChart(document.getElementById("motion")),chartOpts.motion={min:0,max:2,width:250,height:250,legend:{position:"none"}},charts.presence=new google.visualization.ColumnChart(document.getElementById("presence")),chartOpts.presence={min:0,max:100,width:250,height:250,legend:{position:"none"}},setRefreshRate(1e3),getValue()}function getValue(){var e=hostname+"/axis2/services/SensorBoxService/getAllValues";jQuery.ajax({url:e,type:"GET",dataType:"xml",cache:!1,success:function(e,t){if("null"==e);else{var a=new Date;$("#now").text(a.toLocaleString()),updateValues(e)}},error:function(e){}});var t=hostname+"/axis2/services/D316WindowService/getAllStatus";jQuery.ajax({url:t,type:"GET",dataType:"xml",cache:!1,success:function(e,t){"null"==e||updateWindowStatus(e)},error:function(e){}});var a=hostname+"/axis2/services/D316FanService/getStatus";jQuery.ajax({url:a,type:"GET",dataType:"xml",cache:!1,success:function(e,t){"null"==e||updateFanStatus(e)},error:function(e){}});var o=hostname+"/axis2/services/PresenceSensorService/getLikelihood";jQuery.ajax({url:o,type:"GET",dataType:"xml",cache:!1,success:function(e,t){if("null"==e);else{var a=new Object,o=$(e).find("return").text();a.presence=o,drawGraphs(a)}},error:function(e){}}),setTimeout("getValue()",refmSec)}function fanWarm(e){if(e>0&&e<5);}function fanPower(e){var t="off";e>0&&e<3&&(t="on");var a=hostname+"/axis2/services/D316FanService/"+t;jQuery.ajax({url:a,type:"GET",dataType:"xml",cache:!1,success:function(e,t){},error:function(e){}})}function updateFanStatus(e){"true"===$(e).find("power").text()?$('input[name="power-switch"]').attr("checked","checked"):$('input[name="power-switch"]').attr("checked",!1)}function openWindow(e){var t=hostname+"/axis2/services/D316WindowService/open?num="+e;jQuery.ajax({url:t,type:"GET",dataType:"xml",cache:!1,success:function(e,t){},error:function(e){}})}function closeWindow(e){var t=hostname+"/axis2/services/D316WindowService/close?num="+e;jQuery.ajax({url:t,type:"GET",dataType:"xml",cache:!1,success:function(e,t){},error:function(e){}})}function updateWindowStatus(e){var t=[];$(e).find("return").each(function(){var e=$(this).find("state").text();t.push(e)});for(var a="",o=0;o<t.length;o++){a=a+'<div  style="width:120px; border-style: solid; background-color:'+("close"==t[o]?"#dddddd":"skyblue")+';margin: auto; top:0; bottom:0; left:0; right:0;border-color: #dddddd; font-size: 80%;">window'+o+"<br>"+t[o]+'<br><input type="button" value="open" onclick="openWindow('+o+')"><input type="button" value="close" onclick="closeWindow('+o+')"></div>'}$("#windows").html(a)}function updateValues(e){var t=new Object;$(e).find("return").each(function(){var e=$(this).find("id").text(),a=$(this).find("value").text();t[e]=a}),drawGraphs(t),updateDiscomfortIndex(t),updateDiscomfortIndex2(t)}function drawGraphs(e){for(var t in e){var a=new Array;switch(t){case"light":a[0]=["lux"],a[1]=[parseInt(e[t])],dt=google.visualization.arrayToDataTable(a),charts[t].draw(dt,chartOpts[t]);break;case"sound":a[0]=["","db",{role:"annotation"}],a[1]=["Sound Volume",parseFloat(e[t]),Math.round(100*parseFloat(e[t]))/100+" db"],dt=google.visualization.arrayToDataTable(a),charts[t].draw(dt,chartOpts[t]);break;case"temperature":a[0]=["","C",{role:"annotation"},{role:"style"}],a[1]=["Temperature",parseFloat(e[t]),Math.round(100*parseFloat(e[t]))/100+" C","color: orange"],dt=google.visualization.arrayToDataTable(a),charts[t].draw(dt,chartOpts[t]);break;case"humidity":a[0]=["","C",{role:"annotation"},{role:"style"}],a[1]=["Humidity",parseFloat(e[t]),Math.round(100*parseFloat(e[t]))/100+" %","color: cyan"],dt=google.visualization.arrayToDataTable(a),charts[t].draw(dt,chartOpts[t]);break;case"gasPressure":a[0]=["","kPa",{role:"annotation"},{role:"style"}],a[1]=["Gas Pressure",parseFloat(e[t]),Math.round(100*parseFloat(e[t]))/100+" kPa","color: green"],dt=google.visualization.arrayToDataTable(a),charts[t].draw(dt,chartOpts[t]);break;case"presence":a[0]=["","",{role:"annotation"},{role:"style"}],a[1]=["Presence",parseInt(e[t]),parseInt(e[t])+" %","color: violet"],dt=google.visualization.arrayToDataTable(a),charts[t].draw(dt,chartOpts[t]);break;case"motion":a[0]=["","kPa",{role:"annotation"},{role:"style"}];var o="true"==e[t]?2:1;a[1]=["Motion",parseFloat(o),e[t],"color: purple"],dt=google.visualization.arrayToDataTable(a),charts[t].draw(dt,chartOpts[t]);break;case"door_sensor_port_0":var r=$(".door_sensor_port_0 .thumb");r.attr("class");"true"===e[t]?r.removeClass("thumbOpened"):($(".door_sensor_port_0 .thumb").removeClass("thumbOpened"),r.addClass("thumbOpened"));break;case"door_sensor_port_7":var r=$(".door_sensor_port_7 .thumb");r.attr("class");"true"===e[t]?r.removeClass("thumbOpened"):($(".door_sensor_port_7 .thumb").removeClass("thumbOpened"),r.addClass("thumbOpened"))}}}function updateDiscomfortIndex(e){var t=parseFloat(e.temperature),a=parseFloat(e.humidity),o=t-.55*(1-.01*a)*(t-14.5);o=Math.round(100*o)/100;var r,n;o<=21?(n="skyblue",r="Comfortable"):o<=24?(n="aliceblue",r="It's OK"):o<=27?(n="yellow",r="A bit discomfort"):o<=29?(n="gold",r="Discomfort"):o<=32?(n="darkorange",r="Warning. Very discomfort"):(n="red",r="Severe. Call emergency");var i='<div style="height:250px;position: relative;"><div style="position:absolute;margin: auto; top:0; bottom:0; left:0; right:0;width:120px; height:120px;font-size: 80%;background-color:'+n+';"><br>'+o+"<br><br>"+r+"</div></div>";return $("#DI").html(i),o}function updateDiscomfortIndex2(e){var t=parseFloat(e.temperature),a=parseFloat(e.humidity),o=.81*t+.01*a*(.99*t-14.3)+46.3;o=Math.round(100*o)/100;var r,n;o<=55?(n="blueviolet",r="Cold"):o<=60?(n="skyblue",r="A bit cold"):o<=65?(n="aliceblue",r="It's OK"):o<=70?(n="palegreen",r="Comfortable"):o<=75?(n="honeydew",r="Not hot"):o<=80?(n="yellow",r="A bit hot"):o<=85?(n="gold",r="Hot"):(n="red",r="Very hot. Call emergency");var i='<div style="height:250px;position: relative;"><div style="position:absolute;margin: auto; top:0; bottom:0; left:0; right:0;width:120px; height:120px; font-size: 80%;background-color:'+n+';"><br>'+o+"<br><br>"+r+"</div></div>";return $("#DI2").html(i),o}function setRefreshRate(e){refmSec=e,$("#refRate").text(e)}var dt,charts=new Object,chartOpts=new Object,refmSec=1e3,ids=["force","gasPressure","humidity","light","sound","temperature","vibration","motion"],warm={1:"green",2:"yellow",3:"orange",4:"red",5:"black"},hostname="http://129.88.49.247:8080";$(function(){google.charts.load("visualization","1.0",{packages:["corechart","gauge"]}),google.charts.setOnLoadCallback(initialize),$("#input-refresh-rate").on("change",function(e){setRefreshRate(this.value)}),$('input[name="warm"]').on("change",function(e){fanWarm(this.value)}),$('input[name="power"]').on("change",function(e){fanPower(this.value)})});